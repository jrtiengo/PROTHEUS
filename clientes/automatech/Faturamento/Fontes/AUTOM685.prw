#Include "Protheus.ch"
#Include "TOTVS.ch"
#include "jpeg.ch"    
#INCLUDE "topconn.ch"
#INCLUDE "XMLXFUN.CH"
#INCLUDE "rwmake.ch"
#include "topconn.ch"
#include "fileio.ch"
#INCLUDE "TbiConn.ch"

#define SW_HIDE             0 // Escondido
#define SW_SHOWNORMAL       1 // Normal
#define SW_NORMAL           1 // Normal
#define SW_SHOWMINIMIZED    2 // Minimizada
#define SW_SHOWMAXIMIZED    3 // Maximizada
#define SW_MAXIMIZE         3 // Maximizada
#define SW_SHOWNOACTIVATE   4 // Na Ativação
#define SW_SHOW             5 // Mostra na posição mais recente da janela
#define SW_MINIMIZE         6 // Minimizada
#define SW_SHOWMINNOACTIVE  7 // Minimizada
#define SW_SHOWNA           8 // Esconde a barra de tarefas
#define SW_RESTORE          9 // Restaura a posição anterior
#define SW_SHOWDEFAULT      10// Posição padrão da aplicação
#define SW_FORCEMINIMIZE    11// Força minimização independente da aplicação executada
#define SW_MAX              11// Maximizada

// ##############################################################################################
// AUTOMATECH SISTEMAS DE AUTOMAÇÃO LTDA                                                       ##
// ------------------------------------------------------------------------------------------- ##
// Referencia: AUTOM685.PRW                                                                    ##
// Parâmetros: Nenhum                                                                          ##
// Tipo......: (X) Programa  ( ) Gatilho ( ) Ponte de Entrada                                  ##                       
// ------------------------------------------------------------------------------------------- ##
// Autor.....: Harald Hans Löschenkohl                                                         ##
// Data......: 13/04/2018                                                                      ##
// Objetivo..: Programa que realiza a configuração do Httppost SmartCliente                    ##
// Parâmetros: kTipo - Indica quais parâmetros serão utilizados pelo programa (Numérico 1)     ##
//             kURL  - Url a ser enviada para pesquisa                                         ##
// Retorno...: Sem Retorno                                                                     ##
// Descrição dos Parâmetros da função :                                                        ##
//             HTTPSSLClient(nSSL2, nSSL3, nTLS1, cPassword, cCertPath, cKeyPath,              ##
//                           nHSM, lClient, nVerbose, nBugs, nState, cCACertPath)              ##
// +-----------------------------------------------------------------------------------------+ ##
// | PARÂMETROS A SEREM UTILIZADOS PARA O COMANDO                                            | ##
// +-----------------------------------------------------------------------------------------+ ##
// | PATÂMETRO   | TIPO      | DESCRIÇÃO DO PARÂMETRO                                    |OBG| ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | nSSL2       | numérico  | Habilit/Desabilita SSL2.                                  | X | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | nSSL3       | numérico  | Habilita/Desabilita SSL3.                                 | X | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | nTLS1       | numérico  | Habilita/Desabilita TLS1.                                 | X | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | cPassword   | caractere | Senha para a chave privada e/ou certificado.              | X | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | cCertPath   | caractere | Indica o caminho do certificado de cliente.               | X | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | cKeyPath    | caractere | Indica o caminho da chave privada de cliente.             | X | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | nHSM        | numérico  | Define se utiliza HSM.                                    |   | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | lClient     | lógico    | Indica se a definição será para conexão pelo SmartClient. |   | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | nVerbose    | numérico  | Habilita/Desabilita Verbose.                              |   | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | nBugs       | numérico  | Habilita/Desabilita Bugs.                                 |   | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | nState      | numérico  | Habilita/Desabilita State.                                |   | ##
// |-------------|-----------|-----------------------------------------------------------|---| ##
// | cCACertPath | caractere | Indica o caminho do certificado de CA.                    |   | ##
// +-----------------------------------------------------------------------------------------+ ##
//###############################################################################################

User Function AUTOM685(kTipo, kURL)

   Local Par_nSSL2       := 0   
   Local Par_nSSL3       := 0   
   Local Par_nTLS1       := 0   
   Local Par_cPass       := ""  
   Local Par_cCertPath   := ""    
   Local Par_cKeyPath    := ""    
   Local Par_nHSM        := 0   
   Local Par_SmartClient := .F. 
   Local Par_nVerbose    := 0   
   Local Par_nBugs       := 0   
   Local Par_nState      := 0   
   Local Par_cCACertPath := ""    
   Local cUrl            := ""
   Local nTimeOut        := 0
   Local aHeadOut        := {}
   Local cHeadRet        := ""
   Local sPostRet        := Nil

   cURL := "https://mqlinuxext.serasa.com.br/Homologa/consultahttps?p=44422944%40adm1605%20%20%20%20%20%20%20%20B49C%20%20%20%20%20%20089738173000115JC%20%20%20%20%20CH0000000%20%20%20%20%20%20%20%20%20%20%20%20S99SINIAN%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N%20%20%20%20%20%20%20%20%20%2000S%20%20%20%20%20%20%20%20000000000000000S%20%20%20%20%20%20%20%20%201%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20P002RE02%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N00100PPX21P%200%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N00300%20%20%20%20%20%20%20%20%20%20%20%2093270-000RSP8GT%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20T999%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20

// cURL := "https://sitenet43.serasa.com.br/Prod/consultahttps?p=44422944%40adm1605%20%20%20%20%20%20%20%20B49C%20%20%20%20%20%20089738173000115JC%20%20%20%20%20CH0000000%20%20%20%20%20%20%20%20%20%20%20%20S99SINIAN%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N%20%20%20%20%20%20%20%20%20%2000S%20%20%20%20%20%20%20%20000000000000000S%20%20%20%20%20%20%20%20%201%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20P002RE02%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N00100PPX21P%200%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N00300%20%20%20%20%20%20%20%20%20%20%20%2093270-000RSP8GT%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20T999%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20

   // #####################################
   // Se não passou o parâmetro, retorna ##
   // ##################################### 
   If kTipo == Nil
      Return(.T.)
   Endif

   // ##############################   
   // Configurações para o SERASA ##
   // ##############################
   If kTipo == 1
   
      Par_nSSL2       := 0   
      Par_nSSL3       := 1   
      Par_nTLS1       := 1   
      Par_cPass       := ""  
      Par_cCertPath   := "" // "\Protheus_data\certs\SERASA\EV\GlobalSignExtendedValidationCA-SHA256-G2.pem"
      Par_cKeyPath    := "" //"\Protheus_data\certs\SERASA\EV\GlobalSignExtendedValidationCA-SHA256-G2.pem"
      Par_cCACertPath := "" // "\Protheus_data\certs\SERASA\EV\GlobalSignExtendedValidationCA-SHA256-G2.pem"
      Par_nHSM        := 0   
      Par_SmartClient := .F. 
      Par_nVerbose    := 0   
      Par_nBugs       := 0   
      Par_nState      := 0   

//      Par_cCertPath   := "\SERASA\Arquivos HTTPS\SERASA\EV\GlobalSignExtendedValidationCA-SHA256-G2.pem"
//      Par_cKeyPath    := "\SERASA\Arquivos HTTPS\SERASA\EV\GlobalSignExtendedValidationCA-SHA256-G2.pem"
//      Par_cCACertPath := "\SERASA\Arquivos HTTPS\SERASA\EV\GlobalSignExtendedValidationCA-SHA256-G2.pem"

   
   Endif

   //######################################################################################
   // Agente do Browser                                                                  ##
   // aadd(aHeadOut,'User-Agent: Mozilla/4.0 (compatible; Protheus ' + GetBuild() + ')') ##
   // #####################################################################################
   aadd(aHeadOut,'User-Agent: Mozilla/5.0 (Windows; U; MSIE 9.0; WIndows NT 9.0; pt-BR)')

   // ###############################################
   // Executa a função com os parâmetros recebidos ##
   // ###############################################
//   HTTPSSLClient(Par_nSSL2,Par_nSSL3, Par_nTLS1, Par_cPass, Par_cCertPath, Par_cKeyPath, Par_nHSM, Par_SmartClient, Par_nVerbose, Par_nBugs, Par_nState, Par_cCACertPath)

   // Envia a requisição ao SERASA
//   sPostRet := HttpSPost(cUrl, "", "", "", "","",nTimeOut,aHeadOut,@cHeadRet)
   


cstring := "c:\retorno\retorno.txt https://mqlinuxext.serasa.com.br/Homologa/consultahttps?p=44422944%40adm1605%20%20%20%20%20%20%20%20B49C%20%20%20%20%20%20089738173000115JC%20%20%20%20%20CH0000000%20%20%20%20%20%20%20%20%20%20%20%20S99SINIAN%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N%20%20%20%20%20%20%20%20%20%2000S%20%20%20%20%20%20%20%20000000000000000S%20%20%20%20%20%20%20%20%201%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20P002RE02%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N00100PPX21P%200%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20N00300%20%20%20%20%20%20%20%20%20%20%20%2093270-000RSP8GT%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20T999%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20"

           x := WinExec('AtechHttpPostAttachmentsFresh.exe' + ' ' + cString)

   If !Empty(sPostRet)
      MsgAlert("1 - Comunicação realizada com sucesso !!!")
   Else
      MsgAlert("2 - Falha na  Comunicação!")
   Endif             
   
Return(.T.)